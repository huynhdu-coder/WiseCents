generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model bank_accounts {
  account_id         Int                  @id @default(autoincrement())
  user_id            Int
  plaid_item_id      String
  plaid_account_id   String               @unique
  name               String?              @db.VarChar(100)
  official_name      String?              @db.VarChar(100)
  type               String?              @db.VarChar(50)
  subtype            String?              @db.VarChar(50)
  current_balance    Decimal?             @db.Decimal(12, 2)
  available_balance  Decimal?             @db.Decimal(12, 2)
  nickname           String?              @db.VarChar(50)
  is_hidden          Boolean?             @default(false)
  created_at         DateTime?            @default(now()) @db.Timestamp(6)
  plaid_items        plaid_items          @relation(fields: [plaid_item_id], references: [plaid_item_id], onDelete: Cascade, onUpdate: NoAction)
  users              users                @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  goal_contributions goal_contributions[]
  goals              goals[]
  transactions       transactions[]
}

model goals {
  goal_id             Int                  @id @default(autoincrement())
  user_id             Int?
  name                String               @db.VarChar(100)
  target_amount       Decimal?             @db.Decimal(12, 2)
  current_amount      Decimal?             @default(0) @db.Decimal(12, 2)
  deadline            DateTime?            @db.Date
  funding_account_id  Int?
  recurring_amount    Decimal?             @db.Decimal(12, 2)
  recurring_frequency String?              @db.VarChar(20)
  last_recurring_date DateTime?            @db.Date
  goal_contributions  goal_contributions[]
  bank_accounts       bank_accounts?       @relation(fields: [funding_account_id], references: [account_id], onUpdate: NoAction, map: "fk_goal_funding_account")
  users               users?               @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
}

model plaid_items {
  plaid_id            Int             @id @default(autoincrement())
  user_id             Int?
  plaid_access_token  String
  plaid_item_id       String          @unique
  created_at          DateTime?       @default(now()) @db.Timestamp(6)
  access_token_cipher String?
  access_token_iv     Bytes?
  access_token_tag    Bytes?
  cursor              String?
  bank_accounts       bank_accounts[]
  users               users?          @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id, plaid_item_id], map: "idx_plaid_items_user_item")
}

model transactions {
  id                Int           @id @default(autoincrement())
  user_id           Int
  account_id        Int
  transaction_id    String        @unique(map: "transactions_plaid_transaction_id_key")
  name              String
  amount            Decimal       @db.Decimal(12, 2)
  date              DateTime      @db.Date
  category_primary  String?       @db.VarChar(50)
  category_detailed String?       @db.VarChar(100)
  created_at        DateTime      @default(now()) @db.Timestamp(6)
  updated_at        DateTime      @updatedAt @db.Timestamp(6)
  bank_accounts     bank_accounts @relation(fields: [account_id], references: [account_id], onDelete: Cascade)
  users             users         @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([user_id])
  @@index([account_id])
  @@index([date])
  @@index([category_primary])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  user_id          Int             @id @default(autoincrement())
  first_name       String          @db.VarChar(50)
  last_name        String          @db.VarChar(50)
  email            String          @unique @db.VarChar(100)
  password         String          @db.VarChar(255)
  phone            String?         @db.VarChar(20)
  dob              DateTime?       @db.Date
  is_admin         Boolean?        @default(false)
  created_at       DateTime?       @default(now()) @db.Timestamp(6)
  updated_at       DateTime?       @default(now()) @db.Timestamp(6)
  primary_intent   String?         @default("general_budgeting") @db.VarChar(50)
  advice_style     String?         @default("balanced") @db.VarChar(50)
  change_tolerance String?         @default("moderate") @db.VarChar(50)
  ai_data_consent  String?         @db.VarChar(10)
  bank_accounts    bank_accounts[]
  goals            goals[]
  plaid_items      plaid_items[]
  transactions     transactions[]
}

model goal_contributions {
  contribution_id Int           @id @default(autoincrement())
  goal_id         Int
  account_id      Int
  amount          Decimal       @db.Decimal(12, 2)
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  bank_accounts   bank_accounts @relation(fields: [account_id], references: [account_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_account")
  goals           goals         @relation(fields: [goal_id], references: [goal_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_goal")
}
